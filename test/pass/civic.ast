root phase RootPhase {
    passes {
        Print
    }
};

enum BasicType {
    prefix = BT,
    values {
        int, float, bool, void
    }
};

enum MonOpEnum {
    prefix = MO,
    values {
        neg, not
    }
};

enum BinOpEnum {
    prefix = BO,
    values {
        mul, add, sub, div, mod, lt, leq, eq, gt, geq, neq, and, or
    }
};

pass A;

traversal Print;
traversal ByteCode;
traversal RenameFor {
    nodes {
        For, VarLet, Var
    }
};

traversal Context {
    nodes {
        Root, GlobalDef, GlobalDec, Stmt, FunDef, Param, For, VarDec, VarLet, Var, FunCall
    }
};

traversal SplitInit {
    nodes {
        Root, GlobalDef, FunBody, VarDec
    }
};

traversal TypeCheck {
    nodes {
        FunDef, FunBody, Return, VarLet, For, DoWhile, While, IfElse, FunCall,
        BinOp, MonOp, Cast, Var, IntConst, FloatConst, BoolConst
    }
};

traversal Refactor {
    nodes {
        Cast, While, StmtList, BinOp, IntConst, FloatConst, BoolConst, Var,
        FunCall
    }
};

traversal Symbols {
    nodes {
        Root, FunDef, FunSymbol, Symbol
    }
};

nodeset Decl {
    nodes {
        FunDef, GlobalDef, GlobalDec
    }
};

nodeset Expr {
    nodes {
        BinOp, MonOp, Cast, FunCall, Var, Ternary, IntConst, FloatConst, BoolConst
    }
};

nodeset Stmt {
    nodes {
        VarLet, FunCall, IfElse, While, DoWhile, For, Return
    }
};

root node Root {
    children {
        Decls decls { construct, mandatory },
        FunSymbol funsymbol { construct },
        Symbol symbol { construct }
    }
};

node Decls {
    children {
        Decl decl { construct, mandatory },
        Decls next { construct }
    }
};

node LocalFunDef {
    children {
        FunDef decl { construct, mandatory },
        LocalFunDef next { construct }
    }
};

node FunDef {
    children {
        FunHeader funheader { construct, mandatory },
        FunBody funbody { construct },
        FunSymbol funsymbol { construct },
        Symbol symbol { construct }
    },
    attributes {
        construct bool external,
        construct bool export
    }
};

node FunHeader {
    children {
        Param params { construct, mandatory }
    },
    attributes {
        construct BasicType rettype,
        construct string id
    }
};

node Param {
    children {
        Param next { construct }
    },
    attributes {
        construct BasicType type,
        construct string id
    }
};

node GlobalDec {
    attributes {
        construct BasicType type,
        construct string id
    }
};

node GlobalDef {
    children {
        Expr expr { construct }
    },
    attributes {
        construct BasicType type,
        construct string id,
        construct bool export,
        Symbol symbol
    }
};

node FunBody {
    children {
        VarDec vardec { construct },
        LocalFunDef localfundef { construct },
        StmtList stmtlist { construct }
    }
};

node VarDec {
    children {
        Expr expr { construct, mandatory },
        VarDec next { construct }
    },
    attributes {
        Symbol symbol,
        construct BasicType type,
        construct string id
    }
};

node StmtList {
    children {
        Stmt stmt { construct, mandatory },
        StmtList next { construct }
    }
};

node VarLet {
    children {
        Expr expr { construct, mandatory }
    },
    attributes {
        Symbol symbol,
        construct string id
    }
};

node FunCall {
    children {
        ExprList params { construct }
    },
    attributes {
        FunSymbol symbol,
        construct string id
    }
};

node ExprList {
    children {
        Expr expr { construct, mandatory },
        ExprList next { construct }
    }
};

node IfElse {
    children {
        Expr condition { construct, mandatory },
        StmtList ifblock { construct },
        StmtList elseblock { construct }
    }
};

node While {
    children {
        Expr condition { construct, mandatory },
        StmtList block { construct }
    }
};

node DoWhile {
    children {
        Expr condition { construct, mandatory },
        StmtList block { construct }
    }
};

node For {
    children {
        Expr initexpr { construct, mandatory },
        Expr boundexpr { construct, mandatory },
        Expr stepexpr { construct },
        StmtList block { construct }
    },
    attributes {
        Symbol symbol,
        construct string id
    }
};

node Return {
    children {
        Expr expr { construct }
    }
};

node BinOp {
    children {
        Expr left { construct, mandatory },
        Expr right { construct, mandatory }
    },
    attributes {
        construct BinOpEnum op
    }
};

node MonOp {
    children {
        Expr expr { construct, mandatory }
    },
    attributes {
        construct MonOpEnum op
    }
};

node Cast {
    children {
        Expr expr { construct, mandatory }
    },
    attributes {
        construct BasicType type
    }
};

node Var {
    attributes {
        construct string id,
        Symbol symbol
    }
};

node IntConst {
    attributes {
        construct int value
    }
};

node FloatConst {
    attributes {
        construct float value
    }
};

node BoolConst {
    attributes {
        construct bool value
    }
};

node Ternary {
    children {
        Expr testexpr { construct, mandatory },
        Expr trueexpr { construct, mandatory },
        Expr falseexpr { construct, mandatory }
    }
};

node Symbol {
    children {
        Symbol next { construct }
    },
    attributes {
        construct bool external,
        construct bool export,
        construct string name,
        construct int scope,
        construct int offset
    }
};

node FunSymbol {
    children {
        FunSymbol next { construct }
    },
    attributes {
        construct bool export,
        construct bool external,
        construct string name,
        construct string scopedname,
        construct int arity,
        construct int scope,
        construct int offset
    }
};
